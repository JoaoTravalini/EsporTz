<form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
  <div class="form-section">
    <h2>Informações Básicas</h2>

    <div class="image-upload-section">
      <div class="image-preview">
        <img [src]="imagePreview || 'assets/default-avatar.png'" alt="Profile picture">
        <div class="upload-overlay" *ngIf="uploadingImage">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
      </div>
      <div class="upload-actions">
        <input
          type="file"
          #fileInput
          accept="image/jpeg,image/png,image/webp"
          (change)="onImageSelected($event)"
          style="display: none">
        <button
          mat-raised-button
          type="button"
          (click)="fileInput.click()"
          [disabled]="uploadingImage">
          <mat-icon>photo_camera</mat-icon>
          Alterar Foto
        </button>
        <p class="upload-hint">JPG, PNG ou WEBP. Máximo 5MB.</p>
      </div>
    </div>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nome</mat-label>
      <input matInput formControlName="name" placeholder="Seu nome">
      <mat-error *ngIf="profileForm.get('name')?.hasError('required')">
        O nome é obrigatório
      </mat-error>
      <mat-error *ngIf="profileForm.get('name')?.hasError('minLength')">
        O nome não pode estar vazio
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Bio</mat-label>
      <textarea
        matInput
        formControlName="bio"
        placeholder="Conte um pouco sobre você"
        rows="4"
        maxlength="500"></textarea>
      <mat-hint align="end">{{ profileForm.get('bio')?.value?.length || 0 }}/500</mat-hint>
      <mat-error *ngIf="profileForm.get('bio')?.hasError('maxLength')">
        Máximo de 500 caracteres
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Localização</mat-label>
      <input matInput formControlName="location" placeholder="Cidade, País">
      <mat-icon matPrefix>location_on</mat-icon>
      <mat-error *ngIf="profileForm.get('location')?.hasError('maxLength')">
        Máximo de 100 caracteres
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Website</mat-label>
      <input matInput formControlName="website" placeholder="https://seusite.com">
      <mat-icon matPrefix>link</mat-icon>
      <mat-error *ngIf="profileForm.get('website')?.hasError('invalidUrl')">
        URL inválida
      </mat-error>
    </mat-form-field>
  </div>

  <div class="form-actions">
    <button mat-button type="button" (click)="onCancel()">
      Cancelar
    </button>
    <button
      mat-raised-button
      color="primary"
      type="submit"
      [disabled]="profileForm.invalid || uploadingImage">
      Salvar Alterações
    </button>
  </div>
</form>
