<div
  class="workout-selector"
  [ngStyle]="{'--selector-accent': getAccentColor(getHeaderAccentType())}"
>
  <header class="selector-header">
    <div class="header-title">
      <div class="header-icon">
        <mat-icon>fitness_center</mat-icon>
      </div>
      <div class="header-copy">
        <h3>Selecionar Treinos</h3>
        <p>
          {{ selectedActivities.length }}/{{ maxSelections }} selecionado{{ selectedActivities.length === 1 ? '' : 's' }}
          <span *ngIf="selectedActivities.length > 0">· {{ selectedActivitiesSummary }}</span>
        </p>
      </div>
    </div>

    <div class="header-actions">
      <button
        *ngIf="selectedActivities.length > 0"
        mat-stroked-button
        color="accent"
        (click)="clearSelection()"
        class="clear-btn"
      >
        <mat-icon>close</mat-icon>
        Limpar
      </button>

      <button
        *ngIf="showSyncButton"
        mat-flat-button
        color="primary"
        (click)="syncWithStrava()"
        [disabled]="isSyncing"
        class="sync-btn"
      >
        <mat-icon>{{ isSyncing ? 'sync' : 'cloud_sync' }}</mat-icon>
        {{ isSyncing ? 'Sincronizando...' : 'Sincronizar Strava' }}
      </button>
    </div>
  </header>

  <!-- Mensagens de erro/sucesso -->
  <div *ngIf="errorMessage" class="error-message">
    <mat-icon color="warn">error</mat-icon>
    {{ errorMessage }}
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading || isSyncing" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <span>{{ isLoading ? 'Carregando atividades...' : 'Sincronizando com Strava...' }}</span>
  </div>

  <!-- Lista de atividades vazia -->
  <div *ngIf="!isLoading && activities.length === 0" class="empty-state">
    <mat-icon class="empty-icon">fitness_center</mat-icon>
    <h3>Nenhuma atividade encontrada</h3>
    <p *ngIf="showSyncButton">
      Sincronize suas atividades do Strava para começar a selecionar treinos.
    </p>
    <p *ngIf="!showSyncButton">
      Conecte sua conta Strava para visualizar e selecionar seus treinos.
    </p>

    <button
      *ngIf="showSyncButton"
      mat-raised-button
      color="primary"
      (click)="syncWithStrava()"
      [disabled]="isSyncing">
      <mat-icon>sync</mat-icon>
      Sincronizar Agora
    </button>
  </div>

  <!-- Filtros e busca -->
  <section *ngIf="!isLoading && activities.length > 0" class="filters-section">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Buscar atividades...</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="Nome ou tipo de atividade" />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </section>

  <!-- Lista de atividades -->
  <section *ngIf="!isLoading && activities.length > 0" class="activities-list">
    <mat-selection-list class="activities-list__list">
      <mat-list-option
        *ngFor="let activity of dataSource.data; trackBy: trackByActivityId"
        [value]="activity.id"
        [selected]="isActivitySelected(activity)"
        (click)="toggleActivitySelection(activity)"
        [disabled]="!canSelectMore() && !isActivitySelected(activity)"
        class="activity-item"
        [ngStyle]="{'--item-accent': getAccentColor(activity.type)}"
      >

        <!-- Conteúdo do item -->
        <div class="activity-content">
          <!-- Header da atividade -->
          <div class="activity-header">
            <div class="activity-info">
              <div class="activity-type-icon">
                <mat-icon>{{ getActivityIcon(activity.type) }}</mat-icon>
              </div>
              <div class="activity-text">
                <h4 class="activity-name">{{ activity.name }}</h4>
                <div class="activity-meta">
                  <span class="activity-type">
                    {{ getActivityTypeName(activity.type) }}
                  </span>
                  <span class="activity-date">
                    {{ workoutService.formatDate(activity.startDate) }}
                  </span>
                </div>
              </div>
            </div>

            <div class="activity-stats">
              <!-- Distância -->
              <div *ngIf="activity.distance" class="stat-item">
                <div class="stat-icon">
                  <mat-icon>straighten</mat-icon>
                </div>
                <div class="stat-copy">
                  <span class="stat-label">Distância</span>
                  <span class="stat-value">{{ workoutService.formatDistance(activity.distance) }}</span>
                </div>
              </div>

              <!-- Tempo -->
              <div *ngIf="activity.movingTime" class="stat-item">
                <div class="stat-icon">
                  <mat-icon>schedule</mat-icon>
                </div>
                <div class="stat-copy">
                  <span class="stat-label">Tempo</span>
                  <span class="stat-value">{{ workoutService.formatDuration(activity.movingTime) }}</span>
                </div>
              </div>

              <!-- Velocidade -->
              <div *ngIf="activity.averageSpeed" class="stat-item">
                <div class="stat-icon">
                  <mat-icon>speed</mat-icon>
                </div>
                <div class="stat-copy">
                  <span class="stat-label">Vel. Média</span>
                  <span class="stat-value">{{ workoutService.formatSpeed(activity.averageSpeed) }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Descrição (se existir) -->
          <div *ngIf="activity.description" class="activity-description">
            {{ activity.description }}
          </div>

          <!-- Ações -->
          <div class="activity-actions">
            <button
              mat-icon-button
              (click)="showActivityDetails(activity); $event.stopPropagation()"
              class="details-btn">
              <mat-icon>info</mat-icon>
            </button>
          </div>
        </div>
      </mat-list-option>
    </mat-selection-list>
  </section>

  <!-- Limit message -->
  <div *ngIf="!canSelectMore() && selectedActivities.length > 0" class="limit-message">
    <mat-icon color="primary">info</mat-icon>
    Você atingiu o limite máximo de {{ maxSelections }} atividades por post.
  </div>
</div>